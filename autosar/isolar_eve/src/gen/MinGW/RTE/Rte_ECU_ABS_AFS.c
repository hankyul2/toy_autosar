/** @file     Rte_ECU_ABS_AFS.c
  * 
  * @brief    RTE Sample SWC implementation skeleton file
  * 
  * @note     Generated by ETAS GmbH  RTA-RTE v5.8.4  (R4.0 backend version: v7.8.7 (Build 46772))
  */

#include "Rte_ECU_ABS_AFS.h"
#include "VirtualDevices.h"

int orgLRMotor = -1;
int orgUDMotor = -1;
int orgHighBeam = -1;
int orgLowBeam = -1;

/* --------------------------------------------------------------------------- */
/* RTE Event: /Components/ECU_ABS_AFS/IB_ECU_ABS/OIE_DISTANCE */

FUNC(void, ECU_ABS_AFS_CODE) RE_ECU_DISTANCE(CONSTP2VAR(sint32, AUTOMATIC, RTE_APPL_DATA) ADP_ECU_TO_SENSOR)
{
   *ADP_ECU_TO_SENSOR = GetDistanceSensor();
}

/* --------------------------------------------------------------------------- */
/* RTE Event: /Components/ECU_ABS_AFS/IB_ECU_ABS/OIE_LIGHT */

FUNC(void, ECU_ABS_AFS_CODE) RE_ECU_LIGHT(CONSTP2VAR(sint32, AUTOMATIC, RTE_APPL_DATA) ADP_ECU_TO_SENSOR)
{
	*ADP_ECU_TO_SENSOR = GetLightSensor();
}

/* --------------------------------------------------------------------------- */
/* RTE Event: /Components/ECU_ABS_AFS/IB_ECU_ABS/OIE_LIGHTMODE */

FUNC(void, ECU_ABS_AFS_CODE) RE_ECU_LIGHTMODE(CONSTP2VAR(sint32, AUTOMATIC, RTE_APPL_DATA) ADP_ECU_TO_SENSOR)
{
	*ADP_ECU_TO_SENSOR = GetLightModeSensor();
}

/* --------------------------------------------------------------------------- */
/* RTE Event: /Components/ECU_ABS_AFS/IB_ECU_ABS/OIE_SPEED */

FUNC(void, ECU_ABS_AFS_CODE) RE_ECU_SPEED(CONSTP2VAR(sint32, AUTOMATIC, RTE_APPL_DATA) ADP_ECU_TO_SENSOR)
{
	*ADP_ECU_TO_SENSOR = GetSpeedSensor();
}

/* --------------------------------------------------------------------------- */
/* RTE Event: /Components/ECU_ABS_AFS/IB_ECU_ABS/OIE_STEERINGANGLE */

FUNC(void, ECU_ABS_AFS_CODE) RE_ECU_STEERINGANGLE(CONSTP2VAR(sint32, AUTOMATIC, RTE_APPL_DATA) ADP_ECU_TO_SENSOR)
{
	*ADP_ECU_TO_SENSOR = GetSteeringAngleSensor();
}

/* --------------------------------------------------------------------------- */
/* RTE Event: /Components/ECU_ABS_AFS/IB_ECU_ABS/TE_ACTUATOR */

FUNC(void, ECU_ABS_AFS_CODE) RE_ECU_ACTUATOR(void)
{
	int curLRMotor = 0;
	int curUDMotor = 0;
	int curHighBeam = 0;
	int curLowBeam = 0;
	int absLowBeam;

	Rte_Call_R_HIGHBEAMMODE_FROM_ACT_HIGHBEAM_OPER_ACT_TO_ECU(&curHighBeam);
	Rte_Call_R_LOWBEAMMODE_FROM_ACT_LOWBEAM_OPER_ACT_TO_ECU(&curLowBeam);
	Rte_Call_R_LEFTRIGHTANGLE_FROM_ACT_LEFTRIGHT_MOTOR_OPER_ACT_TO_ECU(&curLRMotor);
	Rte_Call_R_UPDOWNANGLE_FROM_ACT_UPDOWN_MOTOR_OPER_ACT_TO_ECU(&curUDMotor);

	if (curHighBeam != orgHighBeam){
		SetHighBeamActuator(curHighBeam);
		if (curHighBeam){
			status_printf("[ECU] 하이빔이 켜졌습니다.", curHighBeam);
		} else {
			status_printf("[ECU] 하이빔이 꺼졌습니다.", curHighBeam);
		}
		orgHighBeam = curHighBeam;
	}

	if (orgLowBeam != curLowBeam){
		if (curLowBeam <0){
			status_printf("[ECU] 전방에 차가 등장했습니다. 하이빔을 끄고 로우빔을 키겠습니다");
			status_printf("[ECU] 로우빔의 세기는 %d 입니다.", -curLowBeam);
		}
		else if (curLowBeam){
			status_printf("[ECU] 로우빔의 세기는 %d 입니다.", curLowBeam);
		} else {
			status_printf("[ECU] 로우빔이 꺼졌습니다.", curLowBeam);
		}
		SetLowBeamActuator(curLowBeam);
		orgLowBeam = curLowBeam;
	}

	curLRMotor = curLRMotor > 0 ? curLRMotor : -curLRMotor;
	if (curLRMotor != orgLRMotor){
		if(curLowBeam != 0){
			SetLEFTRIGHTMotorActuator(curLRMotor);
			status_printf("[ECU] 좌우모터가  %d 각도 만큼 변경되었습니다.", curLRMotor);
			orgLRMotor = curLRMotor;
		}
	}

	curUDMotor = curUDMotor > 0 ? curUDMotor : -curUDMotor;
	if (curUDMotor != orgUDMotor){
		if (curLowBeam != 0){
			SetUPDOWNMotorActuator(curUDMotor);
			status_printf("[ECU] 상하모터가  %d 각도 만큼 변경되었습니다.", curUDMotor);
			orgUDMotor = curUDMotor;
		}
	}
}

